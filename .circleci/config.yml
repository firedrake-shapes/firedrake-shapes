version: 2
jobs:
  build:
    docker:
      - image: florianwechsung/firedrake:latest
      
    working_directory: ~/repo

    steps:
      - checkout
      - run: . /home/firedrake/firedrake/bin/activate; pip3 install wheel --upgrade
      - run: . /home/firedrake/firedrake/bin/activate; pip3 install scipy
      - run: . /home/firedrake/firedrake/bin/activate; pip3 install roltrilinos
      - run: . /home/firedrake/firedrake/bin/activate; pip3 install ROL
      - run: . /home/firedrake/firedrake/bin/activate; export PYTHONPATH=$(pwd):$PYTHONPATH; make test
      - run: . /home/firedrake/firedrake/bin/activate; export PYTHONPATH=$(pwd):$PYTHONPATH; make examples
      - run: . /home/firedrake/firedrake/bin/activate; export PYTHONPATH=$(pwd):$PYTHONPATH; make lint
